swagger: '2.0'
info:
  description: |

    This repository contains a simple, open, and API used for separate UAS Service Suppliers (USS) to communicate during UAS operations, known as the InterUSS Platformâ„¢. This flexible and distributed system is used to connect multiple USSs operating in the same general area to share safety information while protecting operator and consumer privacy. The system is focused on facilitating communication amongst actively operating USSs with no details about UAS operations stored or processed on the InterUSS Platform.

    ### Main Features

    * Simple, open, flexible, and scalable information interface and Optimistic Concurrency Control to simplify USS to USS communication and control race conditions.
    * Effective information sharing to enable effective, deterministic conflict detection for flight planning across multiple overlapping 4D volumes from multiple USSs.
    * Effective reconstitution of flight volumes when restarting a USS or adding a USS to an existing environment.

    ### Main Assumptions

    * Trust each USS to deconflict with known flight data.
    * Auditing is available, as all USSs can verify the authorship and addition of erroneous conflictions.
    * Deconfliction is simply defined as no overlapping flights in time and volume.

    For more information, see the InterUSS Platform technical document located here: https://github.com/wing-aviation/InterUSS-Platform/raw/master/assets/InterUSS%20Platform%20Open%20Source%20Project-v1%20DRAFT.pdf or the executive summary located here:
    https://github.com/wing-aviation/InterUSS-Platform/blob/master/assets/InterUSS%20Platform%20Executive%20Summary-v1%20DRAFT.pdf

    ### NOTE

    This is a NASA UTM Project delta on the original.  In the future, this can be a branch or a fork from a publicly-available repo of InterUSS.

    # Try it out

    The below API are connected to a sandbox environment to allow you to try the different API. For endpoints with Authorization, use a NASA FIMS valid OAuth token or use 'tcl4box' (which works only in the sandbox environment). You can also use additional info at the end of the token to simulate multiple USSs (i.e. 'tcl4box-uss1').

  version: "tcl4.1.1"
  title: InterUSS Platform - Data Node Stateless API
  contact:
    email: hikevin+interuss@google.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

paths:
  /status:
    get:
      summary: Just a quick status checker on the API layer
      produces:
      - application/json
      responses:
        200:
          description: Success, JSend version of OK
          schema:
            $ref: '#/definitions/JSendStatusResponse'
  /slippy/{zoom}:
    get:
      summary: Figures out which slippy tiles are impacted by a CSV list of latitudes and longitudes
      produces:
      - application/json
      parameters:
      - name: zoom
        in: path
        description: Zoom level to use for tiles
        required: true
        type: integer
      - name: coords
        in: query
        description: CSV list of latitude,longitude,latitude,longitude...
        required: true
        type: string
      - name: coord_type
        in: query
        description: Type of query (point, path, or polygon)
        default: point
        type: string
        enum:
          - point
          - path
          - polygon
      responses:
        200:
          description: Success, JSend version of tiles and links to tiles
          schema:
            $ref: '#/definitions/JSendSlippyResponse'
        400:
          description: Invalid zoom or csv

  /GridCellOperator/{zoom}/{x}/{y}:
    get:
      summary: Provides an instantaneous snapshot of the operators and their operations for a specific GridCell
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: x
        in: path
        description: x tile number in slippy tile format
        required: true
        type: integer
      - name: y
        in: path
        description: y tile number in slippy tile format
        required: true
        type: integer
      responses:
        200:
          description: JSend version of grid operator data, including the sync_token used for updating grids
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Access token not provided
    put:
      summary: Updates the operator and operation data stored in a specific GridCell
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: sync_token
        in: header
        description: The synchronization token retrieved in the original GET GridCellOperator, which is a long (64-bit) integer
        required: true
        type: integer
        format: int64
      - in: body
        name: gridcell_operator
        description: The GridCellOperator information being submitted
        required: true
        schema:
          $ref: '#/definitions/GridCellOperatorRequest'
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: x
        in: path
        description: x tile number in slippy tile format
        required: true
        type: integer
      - name: y
        in: path
        description: y tile number in slippy tile format
        required: true
        type: integer
      responses:
        200:
          description: JSend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Valid OAuth access token
        408:
          description: Unable to lock GridCell
        409:
          description: Sync token does not match (GridCell updated since GET)
        424:
          description: JSON is not in the correct format
    delete:
      summary: Removes the USS entry stored in a specific GridCell
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: x
        in: path
        description: x tile number in slippy tile format
        required: true
        type: integer
      - name: y
        in: path
        description: y tile number in slippy tile format
        required: true
        type: integer
      responses:
        200:
          description: Success, Jend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Access token not provided
        404:
          description: USS not found in the GridCell
        408:
          description: Unable to lock GridCell

  /GridCellOperation/{zoom}/{x}/{y}/{gufi}:
    put:
      summary: Creates or Updates an operation stored in a specific GridCell
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: sync_token
        in: header
        description: The synchronization token retrieved in the original GET GridCellOperator, which is a long (64-bit) integer

        required: true
        type: integer
        format: int64
      - in: body
        name: gridcell_operation
        description: The operation information for the specific GridCell being submitted, useful for creating/updating/deleting a single operation when many operations exist in this GridCell. A USS must have an entry as the operator (/GridCellOperator) in this GridCell already to use this endpoint.
        required: true
        schema:
          $ref: '#/definitions/GridCellOperationRequest'
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: x
        in: path
        description: x tile number in slippy tile format
        required: true
        type: integer
      - name: y
        in: path
        description: y tile number in slippy tile format
        required: true
        type: integer
      - name: gufi
        in: path
        description: GUFI for the Operation to create/modify
        required: true
        type: string
      responses:
        200:
          description: JSend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Valid OAuth access token
        408:
          description: Unable to lock GridCell
        409:
          description: Sync token does not match (GridCell updated since GET)
        424:
          description: JSON is not in the correct format
    delete:
      summary: Removes an operation stored in a specific GridCell
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: x
        in: path
        description: x tile number in slippy tile format
        required: true
        type: integer
      - name: y
        in: path
        description: y tile number in slippy tile format
        required: true
        type: integer
      - name: gufi
        in: path
        description: GUFI for the Operation to remove
        required: true
        type: string
      responses:
        200:
          description: Success, Jend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Access token not provided
        404:
          description: GUFI or USS not found in the GridCell
        408:
          description: Unable to lock GridCell

  /GridCellsOperator/{zoom}:
    get:
      summary: Provides an instantaneous snapshot of the operators and their operations for multiple GridCells based on a series of coordinates (representing a set of points, a path, or a polygon)
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: coords
        in: query
        description: CSV list of latitude,longitude,latitude,longitude...
        required: true
        type: string
      - name: coord_type
        in: query
        description: Type of query (point, path, or polygon)
        default: point
        type: string
        enum:
          - point
          - path
          - polygon
      responses:
        200:
          description: JSend version of grid operator data, including the sync_token used for updating grids
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Access token not provided
    put:
      summary: Updates the operator and operation data stored multiple GridCells based on a series of coordinates (representing a set of points, a path, or a polygon)
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: sync_token
        in: header
        description: The synchronization token retrieved in the original GET GridsCellOperator, which is a long (64-bit) integer
        required: true
        type: integer
        format: int64
      - in: body
        name: gridcell_operator
        description: The GridCellOperator information being submitted
        required: true
        schema:
          $ref: '#/definitions/GridCellsOperatorRequest'
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      responses:
        200:
          description: JSend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Valid OAuth access token
        408:
          description: Unable to lock GridCell
        409:
          description: Sync token does not match (GridCell updated since GET)
        424:
          description: JSON is not in the correct format
    delete:
      summary: Removes the USS entry stored in multiple GridCells based on a series of coordinates (representing a set of points, a path, or a polygon)
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: coords
        in: query
        description: CSV list of latitude,longitude,latitude,longitude...
        required: true
        type: string
      - name: coord_type
        in: query
        description: Type of query (point, path, or polygon)
        default: point
        type: string
        enum:
          - point
          - path
          - polygon
      responses:
        200:
          description: Success, Jend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Access token not provided
        408:
          description: Unable to lock GridCell

  /GridCellsOperation/{zoom}/{gufi}:
    put:
      summary: Creates or Updates an operation stored in multiple GridCells based on a series of coordinates (representing a set of points, a path, or a polygon)
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: sync_token
        in: header
        description: The synchronization token retrieved in the original GET GridCellOperator, which is a long (64-bit) integer

        required: true
        type: integer
        format: int64
      - in: body
        name: gridcell_operation
        description: The operation information for the specific GridCell being submitted, useful for creating/updating/deleting a single operation when many operations exist in this GridCell. A USS must have an entry as the operator (/GridCellOperator) in this GridCell already to use this endpoint.
        required: true
        schema:
          $ref: '#/definitions/GridCellsOperationRequest'
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: gufi
        in: path
        description: GUFI for the Operation to create/modify
        required: true
        type: string
      responses:
        200:
          description: JSend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Valid OAuth access token
        408:
          description: Unable to lock GridCell
        409:
          description: Sync token does not match (GridCell updated since GET)
        424:
          description: JSON is not in the correct format
    delete:
      summary: Removes an operation stored in multiple GridCells based on a series of coordinates (representing a set of points, a path, or a polygon)
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: Bearer tcl4box-uss1
        required: true
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: coords
        in: query
        description: CSV list of latitude,longitude,latitude,longitude...
        required: true
        type: string
      - name: coord_type
        in: query
        description: Type of query (point, path, or polygon)
        default: point
        type: string
        enum:
          - point
          - path
          - polygon
      - name: gufi
        in: path
        description: GUFI for the Operation to remove
        required: true
        type: string
      responses:
        200:
          description: Success, Jend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        403:
          description: Access token not provided
        408:
          description: Unable to lock GridCell

  /UVR/{zoom}/{message_id}:
    put:
      summary: Creates a UAS Volume Reservation (UVR) stored in multiple GridCells retrieved with GET GridCellOperators endpoints
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: tcl4box-uss1
        required: true
      - in: body
        name: uvr
        description: Description of the UVR to be emplaced
        required: true
        schema:
          $ref: '#/definitions/UASVolumeReservation'
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: message_id
        in: path
        description: UUID identifying the UVR (must match message_id field of 'uvr')
        required: true
        type: string
      responses:
        200:
          description: JSend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        401:
          description: Not authorized to perform this operation
        403:
          description: Invalid OAuth access token
        409:
          description: Grid cells change was interrupted
        413:
          description: UVR covers too many grid cells
        424:
          description: JSON is not in the correct format
    delete:
      summary: Removes a UAS Volume Reservation (UVR) stored in multiple GridCells
      produces:
      - application/json
      parameters:
      - name: Authorization
        in: header
        description: Valid OAuth access token
        type: string
        default: tcl4box-uss1
        required: true
      - in: body
        name: uvr
        description: Description of the UVR to be emplaced
        required: true
        schema:
          $ref: '#/definitions/UASVolumeReservation'
      - name: zoom
        in: path
        description: Zoom level in slippy tile format
        required: true
        type: integer
      - name: message_id
        in: path
        description: UUID identifying the UVR (must match message_id field of 'uvr')
        required: true
        type: string
      responses:
        200:
          description: Success, Jend version of updated grid operator data
          schema:
            $ref: '#/definitions/JSendGridCellMetadataResponse'
        400:
          description: Invalid request
        401:
          description: Not authorized to perform this operation
        403:
          description: Invalid OAuth access token
        409:
          description: Grid cells change was interrupted
        413:
          description: UVR covers too many grid cells

definitions:
  JSendStatusResponse:
    type: object
    required:
      - status
      - message
      - version
    properties:
      status:
        type: string
      message:
        type: string
      version:
        type: string
        format: json

  JSendSlippyResponse:
    type: object
    required:
      - status
      - data
    properties:
      status:
        type: string
      message:
        type: string
      data:
        type: object
        format: json
        required:
          - zoom
          - grid_cells
        properties:
          zoom:
            type: integer
          grid_cells:
            type: array
            items:
              type: object
              required:
                - link
                - zoom
                - x
                - y
              properties:
                link:
                  type: string
                zoom:
                  type: integer
                x:
                  type: integer
                y:
                  type: integer

  JSendGridCellMetadataResponse:
    type: object
    required:
      - status
      - sync_token
      - data
    properties:
      status:
        type: string
        minLength: 1
        maxLength: 100
      sync_token:
        type: integer
        format: int64
        minimum: 0
        description: The zxid, which is a long (64-bit) integer
      data:
        $ref: '#/definitions/GridCellMetadataResponse'

  GridCellMetadataResponse:
        type: object
        format: json
        required:
          - version
          - timestamp
        properties:
          version:
            type: integer
          timestamp:
            type: string
            format: date-time
            description: >-
              Forcing ms resolution and UTC only.
            minLength: 24
            maxLength: 24
            example: '2015-08-20T03:14:32.819Z'
          operators:
            type: array
            minItems: 0
            maxItems: 1000
            items:
              $ref: '#/definitions/GridCellOperatorResponse'
          uvrs:
            type: array
            minItems: 0
            maxItems: 1000
            items:
              $ref: '#/definitions/UASVolumeReservation'

  GridCellOperatorResponse:
    type: object
    format: json
    required:
      - uss
      - uss_baseurl
      - version
      - timestamp
      - minimum_operation_timestamp
      - maximum_operation_timestamp
      - announcement_level
      - zoom
      - x
      - y
    properties:
      uss:
        type: string
        description: >-
          USS ID as pulled from the access token provided by OAuth.
        minLength: 4
        maxLength: 250
      uss_baseurl:
        type: string
        description: >-
          Base URL for the USS's web service endpoints hosting the required
          NASA API (https://app.swaggerhub.com/apis/utm/uss/).
        minLength: 1
        maxLength: 200
      version:
        type: integer
        description: >-
          Automatically managed version number of this USSs last update.
        minimum: 0
        maximum: 99999
      timestamp:
        type: string
        format: date-time
        description: >-
          Forcing ms resolution and UTC only.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T10:43:18.937Z'
      minimum_operation_timestamp:
        type: string
        format: date-time
        description: >-
          Earliest operation start time in this grid cell.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T14:11:00.000Z'
      maximum_operation_timestamp:
        type: string
        format: date-time
        description: >-
          Latest operation end time in this grid cell.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T15:00:00.000Z'
      announcement_level:
        type: string
        description: >-
          The level of announcements the USS would like to recieve related to operations
          in this grid cell.  Current just a binary, but expect this enumeration to grow
          as use cases are developed.  For example, USSs may want just security related
          announcements, or would only like announcements that involve changed geographies.
        enum:
          - NONE
          - ALL
      zoom:
        type: integer
      x:
        type: integer
      y:
        type: integer
      operations:
        type: array
        items:
          $ref: '#/definitions/GridCellOperationResponse'

  GridCellOperationResponse:
    type: object
    format: json
    required:
      - version
      - gufi
      - operation_signature
      - effective_time_begin
      - effective_time_end
      - timestamp
    properties:
      version:
        type: integer
        minimum: 0
        maximum: 99999
      gufi:
        type: string
        format: uuid
        description: >-
          GUFI for the Operation described this GridCellOperation.
        maxLength: 36
        minLength: 36
      operation_signature:
        type: string
        format: base64url
        description: >-
          The JWS signature of the Operation described by this GridCellOperation. The JWS signature
          is base64 URL encoded per specification.  The unencoded length of a SHA-256 signature is
          32 bytes and the unencoded length of other potential hash functions can be much longer.
          The min and max should take into consideration all potential base64url encoding of the
          JWS algorithms listed in the RFC https://tools.ietf.org/html/rfc7518#section-3
          Currently, these values do not take this into consideration.
        minLength: 32
        maxLength: 200
      effective_time_begin:
        type: string
        format: date-time
        description: >-
          Start time of operation.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T14:11:00.000Z'
      effective_time_end:
        type: string
        format: date-time
        description: >-
          End time of operation.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T15:00:00.000Z'
      timestamp:
        type: string
        format: date-time
        description: >-
          Forcing ms resolution and UTC only.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T10:43:18.937Z'

  GridCellOperatorRequest:
    type: object
    format: json
    required:
      - uss_baseurl
      - minimum_operation_timestamp
      - maximum_operation_timestamp
    properties:
      uss_baseurl:
        type: string
        description: >-
          Base URL for the USS's web service endpoints hosting the required
          NASA API (https://app.swaggerhub.com/apis/utm/uss/).
        minLength: 1
        maxLength: 200
      minimum_operation_timestamp:
        type: string
        format: date-time
        description: >-
          Earliest operation start time in this grid cell.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T14:11:00.000Z'
      maximum_operation_timestamp:
        type: string
        format: date-time
        description: >-
          Latest operation end time in this grid cell.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T15:00:00.000Z'
      announcement_level:
        type: string
        description: >-
          The level of announcements the USS would like to recieve related to operations
          in this grid cell.  Current just a binary, but expect this enumeration to grow
          as use cases are developed.  For example, USSs may want just security related
          announcements, or would only like announcements that involve changed geographies.
        enum:
          - NONE
          - ALL
      operations:
        type: array
        minItems: 0
        maxItems: 1000
        items:
          $ref: '#/definitions/GridCellOperationRequest'

  GridCellOperationRequest:
    type: object
    format: json
    required:
      - gufi
      - operation_signature
      - effective_time_begin
      - effective_time_end
    properties:
      gufi:
        type: string
        format: uuid
        description: >-
          GUFI for the Operation described this GridCellOperation.
        maxLength: 36
        minLength: 36
      operation_signature:
        type: string
        format: base64url
        description: >-
          The JWS signature of the Operation described by this GridCellOperation. The JWS signature
          is base64 URL encoded per specification.  The unencoded length of a SHA-256 signature is
          32 bytes and the unencoded length of other potential hash functions can be much longer.

          The min and max should take into consideration all potential base64url encoding of the
          JWS algorithms listed in the RFC: https://tools.ietf.org/html/rfc7518#section-3

          Currently, these values do not take this into consideration.
        minLength: 32
        maxLength: 200
      effective_time_begin:
        type: string
        format: date-time
        description: >-
          Start time of operation.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T14:11:00.000Z'
      effective_time_end:
        type: string
        format: date-time
        description: >-
          End time of operation.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T15:00:00.000Z'

  GridCellsOperatorRequest:
    type: object
    format: json
    required:
      - coords
      - uss_baseurl
      - minimum_operation_timestamp
      - maximum_operation_timestamp
    properties:
      coords:
        description: CSV list of latitude,longitude,latitude,longitude...
        type: string
      coord_type:
        description: Type of query (point, path, or polygon)
        default: point
        type: string
        enum:
          - point
          - path
          - polygon
      uss_baseurl:
        type: string
        description: >-
          Base URL for the USS's web service endpoints hosting the required
          NASA API (https://app.swaggerhub.com/apis/utm/uss/).
        minLength: 1
        maxLength: 200
      minimum_operation_timestamp:
        type: string
        format: date-time
        description: >-
          Earliest operation start time in this grid cell.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T14:11:00.000Z'
      maximum_operation_timestamp:
        type: string
        format: date-time
        description: >-
          Latest operation end time in this grid cell.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T15:00:00.000Z'
      announcement_level:
        type: string
        description: >-
          The level of announcements the USS would like to recieve related to operations
          in this grid cell.  Current just a binary, but expect this enumeration to grow
          as use cases are developed.  For example, USSs may want just security related
          announcements, or would only like announcements that involve changed geographies.
        enum:
          - NONE
          - ALL
      operations:
        type: array
        minItems: 0
        maxItems: 1000
        items:
          $ref: '#/definitions/GridCellOperationRequest'

  GridCellsOperationRequest:
    type: object
    format: json
    required:
      - coords
      - gufi
      - operation_signature
      - effective_time_begin
      - effective_time_end
    properties:
      coords:
        description: CSV list of latitude,longitude,latitude,longitude...
        type: string
      coord_type:
        description: Type of query (point, path, or polygon)
        default: point
        type: string
        enum:
          - point
          - path
          - polygon
      gufi:
        type: string
        format: uuid
        description: >-
          GUFI for the Operation described this GridCellOperation.
        maxLength: 36
        minLength: 36
      operation_signature:
        type: string
        format: base64url
        description: >-
          The JWS signature of the Operation described by this GridCellOperation. The JWS signature
          is base64 URL encoded per specification.  The unencoded length of a SHA-256 signature is
          32 bytes and the unencoded length of other potential hash functions can be much longer.

          The min and max should take into consideration all potential base64url encoding of the
          JWS algorithms listed in the RFC: https://tools.ietf.org/html/rfc7518#section-3

          Currently, these values do not take this into consideration.
        minLength: 32
        maxLength: 200
      effective_time_begin:
        type: string
        format: date-time
        description: >-
          Start time of operation.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T14:11:00.000Z'
      effective_time_end:
        type: string
        format: date-time
        description: >-
          End time of operation.
        minLength: 24
        maxLength: 24
        example: '2015-08-20T15:00:00.000Z'

  UASVolumeReservation:
    description: >-
      An area limiting UAS access
    required:
      - uss_name
      - message_id
      - cause
      - geography
      - min_altitude
      - max_altitude
      - effective_time_begin
      - effective_time_end
      - permitted_uas
    properties:
      message_id:
        $ref: '#/definitions/uuid'
      uss_name:
        description: >-
          The uss_id of the enacting USS, matching the access token
        type: string
        minLength: 4
        exclusiveMinimum: false
        maxLength: 250
        exclusiveMaximum: false
      type:
        description: >-
          Type of limitation
        type: string
        enum:
          - DYNAMIC_RESTRICTION
          - STATIC_ADVISORY
      permitted_uas:
        description: >-
          If a UAS flight falls under any of these categories, it is allowed in the UVR
        type: array
        items:
          type: string
          enum:
            - NOT_SET
            - PUBLIC_SAFETY
            - SECURITY
            - NEWS_GATHERING
            - VLOS
            - PART_107
            - PART_101E
            - PART_107X
            - RADIO_LINE_OF_SIGHT
        minItems: 1
      permitted_gufis:
        description: >-
          If a flight operation has one of these GUFIs, it is allowed in the UVR
        type: array
        items:
          $ref: '#/definitions/uuid'
        minItems: 0
        maxItems: 100
        example:
          - '00000000-0000-4444-8888-000000000000'
      cause:
        type: string
        enum:
          - WEATHER
          - ATC
          - SECURITY
          - SAFETY
          - MUNICIPALITY
          - OTHER
      geography:
        $ref: '#/definitions/Polygon'
      effective_time_begin:
        type: string
        format: date-time
        description: >-
          Time that the UVR begins
        minLength: 24
        maxLength: 24
        example: '2015-08-20T14:11:00.000Z'
      effective_time_end:
        type: string
        format: date-time
        description: >-
          Time that the UVR ends
        minLength: 24
        maxLength: 24
        example: '2015-08-20T14:11:00.000Z'
      min_altitude:
        description: >-
          The UVR does not affect flights below this altitude
        allOf:
          - $ref: '#/definitions/Altitude'
        # https://stackoverflow.com/a/41752575
      max_altitude:
        description: >-
          The UVR does not affect flights above this altitude
        allOf:
          - $ref: '#/definitions/Altitude'
        # https://stackoverflow.com/a/41752575
      reason:
        description: Human-readable reason for the UVR
        type: string
        maxLength: 1000
    example:
      message_id: '00000000-0000-4444-8888-000000000000'
      uss_name: 'tcl4box-uss1'
      type: DYNAMIC_RESTRICTION
      cause: SAFETY
      geography:
        type: Polygon
        coordinates:
          - - - -122.0647
              - 37.4090
            - - -122.0644
              - 37.4091
            - - -122.0643
              - 37.4086
            - - -122.0647
              - 37.4090
      effective_time_begin: '2018-11-07T14:08:51.123Z'
      effective_time_end: '2018-11-07T14:09:51.123Z'
      permitted_uas:
        - NOT_SET
      permitted_gufis:
        - '00000000-0000-4444-8888-000000000000'
      min_altitude:
        altitude_value: 400
        vertical_reference: 'W84'
        units_of_measure: 'FT'
      max_altitude:
        altitude_value: 5000
        vertical_reference: 'W84'
        units_of_measure: 'FT'
      reason: 'Test UVR'

  uuid:
    description: >-
      UUID version 4
    type: string
    format: uuidv4
    minLength: 36
    maxLength: 36
    pattern: '^[0-9a-fA-F]{8}\\-[0-9a-fA-F]{4}\\-4[0-9a-fA-F]{3}\\-[8-b][0-9a-fA-F]{3}\\-[0-9a-fA-F]{12}$'
    example: '00000000-0000-4444-8888-000000000000'

  Altitude:
    type: object
    required:
      - altitude_value
      - vertical_reference
      - units_of_measure
    properties:
      altitude_value:
        description: >-
          Number of measure units above the reference datum
        type: number
        format: double
      vertical_reference:
        description: >-
          Vertical reference datum (W84 = WGS84)
        externalDocs:
          description: See FIXM 4.1.0
          url: https://www.fixm.aero/releases/FIXM-4.1.0/doc/schema_documentation_core/Measures_xsd.html#VerticalReferenceType
        type: string
        enum:
          - W84
      units_of_measure:
        description: >-
          Vertical distance units
        externalDocs:
          description: See FIXM 4.1.0
          url: https://www.fixm.aero/releases/FIXM-4.1.0/doc/schema_documentation_core/UnitsOfMeasure_xsd.html#UomHeightType
        type: string
        enum:
          - FT

  Polygon:
    type: object
    required:
      - type
      - coordinates
    description: Based on 2D GeoJSon Polygon
    properties:
      type:
        description: |
          Type of geometry; must be Polygon
        type: string
        enum:
        - Polygon
      coordinates:
        type: array
        description: >-
          Number of polygons; must be 1
        minItems: 1
        maxItems: 1
        items:
          type: array
          description: >-
            Number of vertices in polygon with last vertex matching first vertex
          minItems: 4
          maxItems: 1000
          items:
            type: array
            description: >-
              Coordinates for vertex as (longitude, latitude) degrees
            maxItems: 2
            minItems: 2
            items:
              type: number
              format: double

# Added by API Auto Mocking Plugin
host: sandbox.tcl4.interussplatform.com:8121
basePath: /
schemes:
 - https
